import { ViewChild, Type, Directive, ViewChildren } from '@angular/core';
import { FieldType as CoreFieldType, ɵobserve as observe } from '@ngx-formly/core';
import { Subject } from 'rxjs';
import { MatFormFieldControl } from '@angular/material/form-field';
import * as i0 from "@angular/core";
export class FieldType extends CoreFieldType {
    constructor() {
        super(...arguments);
        this.errorStateMatcher = { isErrorState: () => this.field && this.showError };
        this.stateChanges = new Subject();
        this._errorState = false;
    }
    set matPrefix(prefix) {
        if (prefix) {
            this.props.prefix = prefix;
        }
    }
    set matSuffix(suffix) {
        if (suffix) {
            this.props.suffix = suffix;
        }
    }
    set _controls(controls) {
        this.attachControl(controls.length === 1 ? controls.first : this);
    }
    ngOnDestroy() {
        delete this.formField?._control;
        this.stateChanges.complete();
    }
    setDescribedByIds(_ids) { }
    onContainerClick(_event) {
        this.field.focus = true;
        this.stateChanges.next();
    }
    get errorState() {
        const showError = this.options.showError(this);
        if (showError !== this._errorState) {
            this._errorState = showError;
            this.stateChanges.next();
        }
        return showError;
    }
    get controlType() {
        if (this.props.type) {
            return this.props.type;
        }
        const type = this.field.type;
        return type instanceof Type ? type.prototype.constructor.name : type;
    }
    get focused() {
        return !!this.field.focus && !this.disabled;
    }
    get disabled() {
        return !!this.props.disabled;
    }
    get required() {
        return !!this.props.required;
    }
    get placeholder() {
        return this.props.placeholder || '';
    }
    get shouldPlaceholderFloat() {
        return this.shouldLabelFloat;
    }
    get value() {
        return this.formControl?.value;
    }
    set value(value) {
        this.formControl?.patchValue(value);
    }
    get ngControl() {
        return this.formControl;
    }
    get empty() {
        return this.value == null || this.value === '';
    }
    get shouldLabelFloat() {
        return this.focused || !this.empty;
    }
    get formField() {
        return this.field?.['_formField'];
    }
    attachControl(control) {
        if (this.formField && control !== this.formField._control) {
            this.formField._control = control;
            // temporary fix for https://github.com/angular/material2/issues/6728
            const ngControl = control?.ngControl;
            if (ngControl?.valueAccessor?.hasOwnProperty('_formField')) {
                ngControl.valueAccessor['_formField'] = this.formField;
            }
            ['prefix', 'suffix'].forEach((type) => observe(this.field, ['props', type], ({ currentValue }) => currentValue &&
                Promise.resolve().then(() => {
                    this.options.detectChanges(this.field);
                })));
            // https://github.com/angular/components/issues/16209
            const setDescribedByIds = control.setDescribedByIds.bind(control);
            control.setDescribedByIds = (ids) => {
                setTimeout(() => setDescribedByIds(ids));
            };
        }
    }
}
FieldType.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.11", ngImport: i0, type: FieldType, deps: null, target: i0.ɵɵFactoryTarget.Directive });
FieldType.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.3.11", type: FieldType, viewQueries: [{ propertyName: "matPrefix", first: true, predicate: ["matPrefix"], descendants: true }, { propertyName: "matSuffix", first: true, predicate: ["matSuffix"], descendants: true }, { propertyName: "_controls", predicate: MatFormFieldControl, descendants: true }], usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.11", ngImport: i0, type: FieldType, decorators: [{
            type: Directive
        }], propDecorators: { matPrefix: [{
                type: ViewChild,
                args: ['matPrefix']
            }], matSuffix: [{
                type: ViewChild,
                args: ['matSuffix']
            }], _controls: [{
                type: ViewChildren,
                args: [MatFormFieldControl]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllbGQudHlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy91aS9tYXRlcmlhbC9mb3JtLWZpZWxkL3NyYy9maWVsZC50eXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBMEIsU0FBUyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQzVHLE9BQU8sRUFBRSxTQUFTLElBQUksYUFBYSxFQUFxQixRQUFRLElBQUksT0FBTyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDdEcsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQWdCLG1CQUFtQixFQUFFLE1BQU0sOEJBQThCLENBQUM7O0FBS2pGLE1BQU0sT0FBZ0IsU0FDcEIsU0FBUSxhQUFnQjtJQUYxQjs7UUFvQkUsc0JBQWlCLEdBQXNCLEVBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQzVGLGlCQUFZLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUNuQyxnQkFBVyxHQUFHLEtBQUssQ0FBQztLQThGckI7SUEvR0MsSUFBNEIsU0FBUyxDQUFDLE1BQXdCO1FBQzVELElBQUksTUFBTSxFQUFFO1lBQ1YsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1NBQzVCO0lBQ0gsQ0FBQztJQUNELElBQTRCLFNBQVMsQ0FBQyxNQUF3QjtRQUM1RCxJQUFJLE1BQU0sRUFBRTtZQUNWLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztTQUM1QjtJQUNILENBQUM7SUFFRCxJQUF1QyxTQUFTLENBQUMsUUFBNkM7UUFDNUYsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMs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ZXNDb250ZW50IjpbImltcG9ydCB7IE9uRGVzdHJveSwgVGVtcGxhdGVSZWYsIFZpZXdDaGlsZCwgVHlwZSwgRGlyZWN0aXZlLCBWaWV3Q2hpbGRyZW4sIFF1ZXJ5TGlzdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRmllbGRUeXBlIGFzIENvcmVGaWVsZFR5cGUsIEZvcm1seUZpZWxkQ29uZmlnLCDJtW9ic2VydmUgYXMgb2JzZXJ2ZSB9IGZyb20gJ0BuZ3gtZm9ybWx5L2NvcmUnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTWF0Rm9ybUZpZWxkLCBNYXRGb3JtRmllbGRDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZm9ybS1maWVsZCc7XG5pbXBvcnQgeyBFcnJvclN0YXRlTWF0Y2hlciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2NvcmUnO1xuaW1wb3J0IHsgRm9ybWx5RmllbGRQcm9wcyB9IGZyb20gJy4vZm9ybS1maWVsZC53cmFwcGVyJztcblxuQERpcmVjdGl2ZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRmllbGRUeXBlPEYgZXh0ZW5kcyBGb3JtbHlGaWVsZENvbmZpZzxGb3JtbHlGaWVsZFByb3BzPj5cbiAgZXh0ZW5kcyBDb3JlRmllbGRUeXBlPEY+XG4gIGltcGxlbWVudHMgT25EZXN0cm95LCBNYXRGb3JtRmllbGRDb250cm9sPGFueT5cbntcbiAgQFZpZXdDaGlsZCgnbWF0UHJlZml4Jykgc2V0IG1hdFByZWZpeChwcmVmaXg6IFRlbXBsYXRlUmVmPGFueT4pIHtcbiAgICBpZiAocHJlZml4KSB7XG4gICAgICB0aGlzLnByb3BzLnByZWZpeCA9IHByZWZpeDtcbiAgICB9XG4gIH1cbiAgQFZpZXdDaGlsZCgnbWF0U3VmZml4Jykgc2V0IG1hdFN1ZmZpeChzdWZmaXg6IFRlbXBsYXRlUmVmPGFueT4pIHtcbiAgICBpZiAoc3VmZml4KSB7XG4gICAgICB0aGlzLnByb3BzLnN1ZmZpeCA9IHN1ZmZpeDtcbiAgICB9XG4gIH1cblxuICBAVmlld0NoaWxkcmVuKE1hdEZvcm1GaWVsZENvbnRyb2wpIHNldCBfY29udHJvbHMoY29udHJvbHM6IFF1ZXJ5TGlzdDxNYXRGb3JtRmllbGRDb250cm9sPGFueT4+KSB7XG4gICAgdGhpcy5hdHRhY2hDb250cm9sKGNvbnRyb2xzLmxlbmd0aCA9PT0gMSA/IGNvbnRyb2xzLmZpcnN0IDogdGhpcyk7XG4gIH1cblxuICBlcnJvclN0YXRlTWF0Y2hlcjogRXJyb3JTdGF0ZU1hdGNoZXIgPSB7IGlzRXJyb3JTdGF0ZTogKCkgPT4gdGhpcy5maWVsZCAmJiB0aGlzLnNob3dFcnJvciB9O1xuICBzdGF0ZUNoYW5nZXMgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICBfZXJyb3JTdGF0ZSA9IGZhbHNlO1xuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGRlbGV0ZSAodGhpcy5mb3JtRmllbGQgYXMgYW55KT8uX2NvbnRyb2w7XG4gICAgdGhpcy5zdGF0ZUNoYW5nZXMuY29tcGxldGUoKTtcbiAgfVxuXG4gIHNldERlc2NyaWJlZEJ5SWRzKF9pZHM6IHN0cmluZ1tdKTogdm9pZCB7fVxuICBvbkNvbnRhaW5lckNsaWNrKF9ldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuICAgIHRoaXMuZmllbGQuZm9jdXMgPSB0cnVlO1xuICAgIHRoaXMuc3RhdGVDaGFuZ2VzLm5leHQoKTtcbiAgfVxuXG4gIGdldCBlcnJvclN0YXRlKCkge1xuICAgIGNvbnN0IHNob3dFcnJvciA9IHRoaXMub3B0aW9ucyEuc2hvd0Vycm9yISh0aGlzKTtcbiAgICBpZiAoc2hvd0Vycm9yICE9PSB0aGlzLl9lcnJvclN0YXRlKSB7XG4gICAgICB0aGlzLl9lcnJvclN0YXRlID0gc2hvd0Vycm9yO1xuICAgICAgdGhpcy5zdGF0ZUNoYW5nZXMubmV4dCgpO1xuICAgIH1cblxuICAgIHJldHVybiBzaG93RXJyb3I7XG4gIH1cblxuICBnZXQgY29udHJvbFR5cGUoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMudHlwZSkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcHMudHlwZTtcbiAgICB9XG5cbiAgICBjb25zdCB0eXBlID0gdGhpcy5maWVsZC50eXBlITtcbiAgICByZXR1cm4gdHlwZSBpbnN0YW5jZW9mIFR5cGUgPyB0eXBlLnByb3RvdHlwZS5jb25zdHJ1Y3Rvci5uYW1lIDogdHlwZTtcbiAgfVxuICBnZXQgZm9jdXNlZCgpIHtcbiAgICByZXR1cm4gISF0aGlzLmZpZWxkLmZvY3VzICYmICF0aGlzLmRpc2FibGVkO1xuICB9XG4gIGdldCBkaXNhYmxlZCgpIHtcbiAgICByZXR1cm4gISF0aGlzLnByb3BzLmRpc2FibGVkO1xuICB9XG4gIGdldCByZXF1aXJlZCgpIHtcbiAgICByZXR1cm4gISF0aGlzLnByb3BzLnJlcXVpcmVkO1xuICB9XG4gIGdldCBwbGFjZWhvbGRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9wcy5wbGFjZWhvbGRlciB8fCAnJztcbiAgfVxuICBnZXQgc2hvdWxkUGxhY2Vob2xkZXJGbG9hdCgpIHtcbiAgICByZXR1cm4gdGhpcy5zaG91bGRMYWJlbEZsb2F0O1xuICB9XG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5mb3JtQ29udHJvbD8udmFsdWU7XG4gIH1cbiAgc2V0IHZhbHVlKHZhbHVlKSB7XG4gICAgdGhpcy5mb3JtQ29udHJvbD8ucGF0Y2hWYWx1ZSh2YWx1ZSk7XG4gIH1cbiAgZ2V0IG5nQ29udHJvbCgpIHtcbiAgICByZXR1cm4gdGhpcy5mb3JtQ29udHJvbCBhcyBhbnk7XG4gIH1cbiAgZ2V0IGVtcHR5KCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlID09IG51bGwgfHwgdGhpcy52YWx1ZSA9PT0gJyc7XG4gIH1cbiAgZ2V0IHNob3VsZExhYmVsRmxvYXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZm9jdXNlZCB8fCAhdGhpcy5lbXB0eTtcbiAgfVxuICBnZXQgZm9ybUZpZWxkKCk6IE1hdEZvcm1GaWVsZCB7XG4gICAgcmV0dXJuICh0aGlzLmZpZWxkIGFzIGFueSk/LlsnX2Zvcm1GaWVsZCddO1xuICB9XG5cbiAgcHJpdmF0ZSBhdHRhY2hDb250cm9sKGNvbnRyb2w6IE1hdEZvcm1GaWVsZENvbnRyb2w8YW55Pikge1xuICAgIGlmICh0aGlzLmZvcm1GaWVsZCAmJiBjb250cm9sICE9PSB0aGlzLmZvcm1GaWVsZC5fY29udHJvbCkge1xuICAgICAgdGhpcy5mb3JtRmllbGQuX2NvbnRyb2wgPSBjb250cm9sO1xuXG4gICAgICAvLyB0ZW1wb3JhcnkgZml4IGZvciBodHRwczovL2dpdGh1Yi5jb20vYW5ndWxhci9tYXRlcmlhbDIvaXNzdWVzLzY3MjhcbiAgICAgIGNvbnN0IG5nQ29udHJvbCA9IGNvbnRyb2w/Lm5nQ29udHJvbCBhcyBhbnk7XG4gICAgICBpZiAobmdDb250cm9sPy52YWx1ZUFjY2Vzc29yPy5oYXNPd25Qcm9wZXJ0eSgnX2Zvcm1GaWVsZCcpKSB7XG4gICAgICAgIG5nQ29udHJvbC52YWx1ZUFjY2Vzc29yWydfZm9ybUZpZWxkJ10gPSB0aGlzLmZvcm1GaWVsZDtcbiAgICAgIH1cblxuICAgICAgWydwcmVmaXgnLCAnc3VmZml4J10uZm9yRWFjaCgodHlwZSkgPT5cbiAgICAgICAgb2JzZXJ2ZTxUZW1wbGF0ZVJlZjxhbnk+PihcbiAgICAgICAgICB0aGlzLmZpZWxkLFxuICAgICAgICAgIFsncHJvcHMnLCB0eXBlXSxcbiAgICAgICAgICAoeyBjdXJyZW50VmFsdWUgfSkgPT5cbiAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSAmJlxuICAgICAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5kZXRlY3RDaGFuZ2VzISh0aGlzLmZpZWxkKTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICApLFxuICAgICAgKTtcblxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvY29tcG9uZW50cy9pc3N1ZXMvMTYyMDlcbiAgICAgIGNvbnN0IHNldERlc2NyaWJlZEJ5SWRzID0gY29udHJvbC5zZXREZXNjcmliZWRCeUlkcy5iaW5kKGNvbnRyb2wpO1xuICAgICAgY29udHJvbC5zZXREZXNjcmliZWRCeUlkcyA9IChpZHM6IHN0cmluZ1tdKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc2V0RGVzY3JpYmVkQnlJZHMoaWRzKSk7XG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuIl19